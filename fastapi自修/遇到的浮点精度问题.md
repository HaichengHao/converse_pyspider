ä½ é‡åˆ°çš„ `price_with_tax` æ˜¾ç¤ºä¸º `22.419999999999998` è€Œä¸æ˜¯é¢„æœŸçš„ `22.42`ï¼Œè¿™æ˜¯ç”±äº **æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼ˆFloating-point precision errorï¼‰** å¼•èµ·çš„ï¼Œå±äºè®¡ç®—æœºä¸­æµ®ç‚¹æ•°è¡¨ç¤ºçš„å¸¸è§ç°è±¡ã€‚

---

### ğŸ” é—®é¢˜åˆ†æ

ä½ çš„ä»£ç ä¸­ï¼š

```python
price_with_tax = item.price + item.tax
# item.price = 22.2
# item.tax = 0.22
# æ‰€ä»¥ï¼š22.2 + 0.22 = 22.42
```

ä½†å®é™…ç»“æœå´æ˜¯ï¼š

```json
"price_with_tax": 22.419999999999998
```

è¿™æ˜¯å› ä¸ºï¼š

- åœ¨è®¡ç®—æœºä¸­ï¼Œ`float` ç±»å‹ä½¿ç”¨ **IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°æ ‡å‡†** è¡¨ç¤ºå°æ•°ã€‚
- åƒ `22.2` å’Œ `0.22` è¿™æ ·çš„åè¿›åˆ¶å°æ•°ï¼Œåœ¨äºŒè¿›åˆ¶ä¸‹æ˜¯ **æ— é™å¾ªç¯å°æ•°**ï¼Œæ— æ³•è¢«ç²¾ç¡®è¡¨ç¤ºã€‚
- å› æ­¤ï¼Œ`22.2 + 0.22` çš„ç»“æœåœ¨è®¡ç®—æ—¶å­˜åœ¨å¾®å°è¯¯å·®ï¼Œæœ€ç»ˆæ˜¾ç¤ºä¸º `22.419999999999998`ã€‚

> âœ… è¿™ä¸æ˜¯ FastAPI çš„é—®é¢˜ï¼Œä¹Ÿä¸æ˜¯ Pydantic çš„é—®é¢˜ï¼Œè€Œæ˜¯ Python ä¸­ `float` ç±»å‹æœ¬èº«çš„ç²¾åº¦é™åˆ¶ã€‚

---

### âœ… è§£å†³æ–¹æ¡ˆ

#### âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `round()` å‡½æ•°ï¼ˆæ¨èï¼Œç®€å•å®ç”¨ï¼‰

```python
@app.post('/items/')
async def getitem(item: Item):
    item_dict = item.dict()
    if item.tax is not None:
        price_with_tax = item.price + item.tax
        price_with_tax = round(price_with_tax, 2)  # ä¿ç•™ä¸¤ä½å°æ•°
        item_dict.update({'price_with_tax': price_with_tax})
    return item_dict
```

âœ… è¾“å‡ºç»“æœï¼š

```json
{
  "name": "å°ç‹",
  "ag": 22,
  "description": "string",
  "price": 22.2,
  "tax": 0.22,
  "price_with_tax": 22.42
}
```

---

#### âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ `decimal.Decimal`ï¼ˆé«˜ç²¾åº¦ï¼Œé€‚åˆé‡‘èè®¡ç®—ï¼‰

å¦‚æœä½ å¯¹ç²¾åº¦è¦æ±‚æé«˜ï¼ˆå¦‚é‡‘é¢è®¡ç®—ï¼‰ï¼Œå»ºè®®ä½¿ç”¨ `Decimal`ï¼š

```python
from decimal import Decimal

@app.post('/items/')
async def getitem(item: Item):
    item_dict = item.dict()
    if item.tax is not None:
        price_with_tax = Decimal(str(item.price)) + Decimal(str(item.tax))
        item_dict.update({'price_with_tax': float(price_with_tax)})  # æˆ–ä¿ç•™ä¸ºå­—ç¬¦ä¸²/Decimal
    return item_dict
```

> âš ï¸ æ³¨æ„ï¼š`Decimal` éœ€è¦ä»å­—ç¬¦ä¸²åˆå§‹åŒ–ï¼ˆå¦‚ `Decimal('22.2')`ï¼‰æ‰èƒ½é¿å…æµ®ç‚¹è¯¯å·®ã€‚

---

#### âŒ ä¸æ¨èï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œæ¥å—æµ®ç‚¹è¯¯å·®

è™½ç„¶ä¸å½±å“è®¡ç®—é€»è¾‘ï¼Œä½†åœ¨è¿”å›ç»™å‰ç«¯æ—¶æ˜¾ç¤º `22.419999999999998` ä¼šæ˜¾å¾—ä¸ä¸“ä¸šï¼Œå®¹æ˜“å¼•èµ·ç”¨æˆ·ç–‘è™‘ã€‚

---

### ğŸ”§ é¢å¤–å»ºè®®ï¼šå­—æ®µåæ‹¼å†™æ£€æŸ¥

ä½ ä¼ å…¥çš„ JSON ä¸­æ˜¯ `"ag": 22`ï¼Œä½†æ¨¡å‹ä¸­å®šä¹‰çš„æ˜¯ `age: int`ã€‚

```json
{
  "name": "å°ç‹",
  "ag": 22,  // è¿™é‡Œæ˜¯ "ag"ï¼Œä¸æ˜¯ "age"
  ...
}
```

è€Œä½ çš„æ¨¡å‹æ˜¯ï¼š

```python
class Item(BaseModel):
    name: str
    age: int = Field(default=0, gt=0, lt=100)
    ...
```

ğŸ‘‰ è¿™ä¼šå¯¼è‡´ `age` ä½¿ç”¨é»˜è®¤å€¼ `0`ï¼Œè€Œä¸æ˜¯ `22`ï¼

âœ… æ­£ç¡®ä¼ å‚åº”ä¸ºï¼š

```json
{
  "name": "å°ç‹",
  "age": 22,
  "description": "string",
  "price": 22.2,
  "tax": 0.22
}
```

å¦åˆ™ `age` ä¸ä¼šè¢«æ­£ç¡®èµ‹å€¼ï¼

---

### âœ… æ€»ç»“

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|-----------|
| `price_with_tax` æ˜¾ç¤ºå¼‚å¸¸ | æµ®ç‚¹æ•°ç²¾åº¦è¯¯å·® | ä½¿ç”¨ `round(price_with_tax, 2)` |
| `age` æ²¡æœ‰è¢«æ­£ç¡®èµ‹å€¼ | è¯·æ±‚å­—æ®µåå†™é”™ï¼ˆ`ag` â‰  `age`ï¼‰ | æ”¹ä¸º `"age": 22` |

---

âœ… æ¨èæœ€ç»ˆä¿®å¤åçš„ä»£ç ï¼š

```python
@app.post('/items/')
async def getitem(item: Item):
    item_dict = item.dict()
    if item.tax is not None:
        price_with_tax = item.price + item.tax
        item_dict['price_with_tax'] = round(price_with_tax, 2)
    return item_dict
```

å¹¶ç¡®ä¿è¯·æ±‚ä½“ä½¿ç”¨æ­£ç¡®çš„å­—æ®µåï¼š

```json
{
  "name": "å°ç‹",
  "age": 22,
  "description": "string",
  "price": 22.2,
  "tax": 0.22
}
```

è¿™æ ·å°±èƒ½å¾—åˆ°ä½ æœŸæœ›çš„ç»“æœäº† âœ…