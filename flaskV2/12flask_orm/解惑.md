ä½ æåˆ°çš„ `Flask-Script` ç¡®å®å·²ç»è¢«åºŸå¼ƒï¼Œä¸å†ç»´æŠ¤ã€‚ç°ä»£ Flask æ¨èä½¿ç”¨ **Click** å‘½ä»¤è¡Œæ¥å£æ¥åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ã€‚`Flask-Migrate` ä¹Ÿæ—©å·²æ”¯æŒä¸ Flask çš„å†…ç½® CLI é›†æˆï¼Œæ— éœ€ `Flask-Script` å’Œ `Manager`ã€‚

ä¸‹é¢æ˜¯å°†ä½ çš„æ—§ä»£ç è¿ç§»åˆ°ç°ä»£ Flask CLI é£æ ¼çš„å®Œæ•´ç¤ºä¾‹ï¼š

---

### âœ… æ¨èæ–¹å¼ï¼šä½¿ç”¨ Flask å†…ç½® CLI + Click

#### 1. é¡¹ç›®ç»“æ„å»ºè®®
```
your_project/
â”œâ”€â”€ app.py
â”œâ”€â”€ settings.py
â”œâ”€â”€ obj/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ exts.py
```

---

#### 2. `obj/exts.py`
```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()
```

---

#### 3. `obj/__init__.py`
```python
from flask import Flask
from .exts import db
from flask_migrate import Migrate

def create_app(config_name='development'):
    app = Flask(__name__)

    # åŠ è½½é…ç½®
    from settings import devConfig, proConfig  # å‡è®¾æœ‰å¤šä¸ªé…ç½®
    config_map = {
        'development': devConfig,
        'production': proConfig
    }
    app.config.from_object(config_map.get(config_name, devConfig))

    # åˆå§‹åŒ–æ‰©å±•
    db.init_app(app)
    Migrate(app, db)  # è‡ªåŠ¨æ³¨å†Œ flask db å‘½ä»¤

    return app
```

---

#### 4. `app.py`ï¼ˆä¸»ç¨‹åºå…¥å£ï¼‰
```python
import click
from obj import create_app
from obj.exts import db

app = create_app()

# è‡ªå®šä¹‰å‘½ä»¤ç¤ºä¾‹
@app.cli.command("init-db")
def init_db_command():
    """åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ï¼‰"""
    db.create_all()
    click.echo("Initialized the database.")

@app.cli.command("hello")
@click.option('--name', default='World', help='åå­—')
def hello(name):
    """æ‰“æ‹›å‘¼å‘½ä»¤"""
    click.echo(f'Hello, {name}!')

if __name__ == '__main__':
    app.run(debug=True)
```

---

#### 5. ä½¿ç”¨æ–¹å¼ï¼ˆå‘½ä»¤è¡Œï¼‰

```bash
# è®¾ç½®åº”ç”¨å…¥å£ï¼ˆLinux/macOSï¼‰
export FLASK_APP=app.py
export FLASK_ENV=development  # æˆ– FLASK_DEBUG=1

# Windows ä½¿ç”¨ set æˆ– $env:FLASK_APP="app.py"ï¼ˆPowerShellï¼‰

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
flask run

# æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
flask --help

# æŸ¥çœ‹ db å‘½ä»¤ï¼ˆæ¥è‡ª Flask-Migrateï¼‰
flask db --help

# æ‰§è¡Œè¿ç§»æ“ä½œ
flask db init      # é¦–æ¬¡åˆ›å»ºè¿ç§»ä»“åº“
flask db migrate -m "Initial migration"
flask db upgrade

# æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤
flask init-db
flask hello --name Alice
```

---

### âœ… å…³é”®ç‚¹è¯´æ˜

| æ—§æ–¹å¼ | æ–°æ–¹å¼ |
|-------|--------|
| `Flask-Script` + `Manager` | Flask å†…ç½® CLIï¼ˆåŸºäº Clickï¼‰ |
| `manager.add_command('db', MigrateCommand)` | `Migrate(app, db)` è‡ªåŠ¨æ³¨å†Œ `flask db` å‘½ä»¤ |
| `python app.py runserver` | `flask run` |
| è‡ªå®šä¹‰å‘½ä»¤é€šè¿‡ `@manager.command` | ä½¿ç”¨ `@app.cli.command()` |

---

### ğŸ” è¿ç§»æ€»ç»“

ä½ åŸæ¥çš„ä»£ç ï¼š
```python
from flask_script import Manager
manager = Manager(app)
mig = Migrate(app=app,db=db)
manager.add_command('db', MigrateCommand)
```

ç°åœ¨å®Œå…¨ä¸éœ€è¦ `Manager`ï¼Œåªéœ€ï¼š
```python
from flask_migrate import Migrate
Migrate(app, db)  # è¿™ä¸€è¡Œå°±è‡ªåŠ¨å¯ç”¨äº† flask db å‘½ä»¤
```

---

### âœ… é¢å¤–å»ºè®®

- å¸è½½ `Flask-Script`ï¼š`pip uninstall Flask-Script`
- ç¡®ä¿å®‰è£…äº† `Flask-Migrate`ï¼š`pip install Flask-Migrate`
- ä½¿ç”¨ `Flask` 2.0+ ç‰ˆæœ¬ä»¥è·å¾—æœ€ä½³ CLI æ”¯æŒ

---

è¿™æ ·ä½ å°±å®Œå…¨æ‘†è„±äº†åºŸå¼ƒçš„ `Flask-Script`ï¼Œä½¿ç”¨æ›´ç°ä»£ã€å®˜æ–¹æ¨èçš„æ–¹å¼ç®¡ç†å‘½ä»¤è¡Œå·¥å…·ã€‚



ä½ çš„ä»£ç **åŸºæœ¬ç»“æ„æ˜¯å¯¹çš„**ï¼Œä½†æœ‰ä¸€äº›**é¡ºåºå’Œè®¾è®¡ä¸Šçš„å°é—®é¢˜**éœ€è¦è°ƒæ•´ï¼Œæ‰èƒ½ç¡®ä¿ `Flask-Migrate` æ­£å¸¸å·¥ä½œï¼Œå¹¶ç¬¦åˆç°ä»£ Flask çš„æœ€ä½³å®è·µã€‚

---

### âŒ ä½ å½“å‰ä»£ç çš„é—®é¢˜ï¼š

```python
app = create_app()
app.config.from_object(devConfig)  # â† é—®é¢˜1ï¼šé‡å¤é…ç½®
db.init_app(app)                   # â† é—®é¢˜2ï¼šcreate_app å†…éƒ¨åº”è¯¥åšè¿™äº‹
mig = Migrate(app=app, db=db)      # â† é—®é¢˜3ï¼šåº”åœ¨ create_app ä¸­åˆå§‹åŒ–
app.run()
```

#### é—®é¢˜è¯¦è§£ï¼š

1. **`app.config.from_object(devConfig)` æ”¾åœ¨äº†å¤–é¢**  
   å¦‚æœä½ åœ¨ `create_app()` å‡½æ•°é‡Œå·²ç»è®¾ç½®äº†é…ç½®ï¼Œè¿™é‡Œåˆè®¾ç½®ä¸€æ¬¡ï¼Œå±äºé‡å¤æ“ä½œï¼Œå®¹æ˜“å‡ºé”™ã€‚

2. **`db.init_app(app)` å†™åœ¨äº†ä¸»ç¨‹åºä¸­**  
   æ‰©å±•çš„åˆå§‹åŒ–ï¼ˆå¦‚ `db.init_app(app)`ï¼‰åº”è¯¥å°è£…åœ¨ `create_app()` å·¥å‚å‡½æ•°å†…éƒ¨ï¼Œè¿™æ˜¯å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³ã€‚

3. **`Migrate(app, db)` å†™åœ¨äº†å¤–é¢**  
   åŒæ ·ï¼Œ`Migrate` ä¹Ÿåº”è¯¥åœ¨ `create_app` ä¸­åˆå§‹åŒ–ï¼Œå¦åˆ™ `flask db` å‘½ä»¤ä¸ä¼šç”Ÿæ•ˆã€‚

4. **æ²¡æœ‰å¯ç”¨ Flask CLI æ”¯æŒçš„å‘½ä»¤**  
   è™½ç„¶ä½ å¯ä»¥è¿è¡ŒæœåŠ¡å™¨ï¼Œä½†å¦‚æœä½ æƒ³ç”¨ `flask db migrate` ç­‰å‘½ä»¤ï¼Œå¿…é¡»é€šè¿‡ `flask run` å¯åŠ¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ `app.run()`ã€‚

---

### âœ… æ­£ç¡®åšæ³•ï¼ˆæ¨èç»“æ„ï¼‰

#### âœ… 1. `obj/__init__.py`
```python
from flask import Flask
from .exts import db
from flask_migrate import Migrate

def create_app(config_name='development'):
    app = Flask(__name__)
    
    # åŠ è½½é…ç½®
    from settings import devConfig
    app.config.from_object(devConfig)

    # åˆå§‹åŒ–æ‰©å±•
    db.init_app(app)
    Migrate(app, db)  # å…³é”®ï¼šåœ¨è¿™é‡Œåˆå§‹åŒ– Migrate

    return app
```

#### âœ… 2. `app.py`ï¼ˆå…¥å£æ–‡ä»¶ï¼‰
```python
from obj import create_app

app = create_app()

if __name__ == '__main__':
    # ä»…ç”¨äºå¼€å‘æ—¶ç›´æ¥è¿è¡Œï¼špython app.py
    app.run(host='0.0.0.0', port=5000, debug=True)
```

---

### âœ… ä½¿ç”¨æ–¹å¼

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Flask CLIï¼ˆæ¨èï¼‰
```bash
export FLASK_APP=app.py
export FLASK_ENV=development
flask run
```

ä½ å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿ç§»å‘½ä»¤ï¼š
```bash
flask db init         # é¦–æ¬¡åˆ›å»ºè¿ç§»ç›®å½•
flask db migrate -m "init"
flask db upgrade
```

#### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œï¼ˆä»…å¼€å‘ï¼‰
```bash
python app.py
```

---

### âœ… æ€»ç»“ï¼šä½ çš„ä»£ç æ€ä¹ˆæ”¹ï¼Ÿ

ä½ åŸæ¥çš„ä¸»ç¨‹åºæ”¹æˆè¿™æ ·å°± OK äº†ï¼š

```python
from obj import create_app

if __name__ == '__main__':
    app = create_app()  # æ‰€æœ‰åˆå§‹åŒ–éƒ½åœ¨ create_app é‡Œå®Œæˆ
    app.run()
```

ç„¶åæŠŠï¼š
- `app.config.from_object(devConfig)`
- `db.init_app(app)`
- `Migrate(app, db)`

å…¨éƒ¨ç§»åˆ° `create_app()` å‡½æ•°å†…éƒ¨ï¼

---

### ğŸ¯ æœ€ç»ˆç»“è®º

> âŒ ä½ ç°åœ¨çš„å†™æ³• **ä¸èƒ½å®Œå…¨æ­£å¸¸å·¥ä½œ**ï¼ˆå°¤å…¶æ˜¯ `flask db` å‘½ä»¤ä¼šå¤±æ•ˆï¼‰  
> âœ… æ­£ç¡®åšæ³•æ˜¯ï¼š**æŠŠ `Migrate(app, db)` æ”¾åˆ° `create_app()` å‡½æ•°ä¸­åˆå§‹åŒ–**

---

### ğŸ” å°è´´å£«ï¼šå¦‚ä½•éªŒè¯ Migrate æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

è¿è¡Œï¼š
```bash
flask --help
```

å¦‚æœçœ‹åˆ° `db` å‘½ä»¤å‡ºç°åœ¨åˆ—è¡¨ä¸­ï¼š
```
Commands:
  db    Perform database migrations.
  run   Run a development server.
  shell Run an interactive Python shell in the app context.
```

è¯´æ˜ `Flask-Migrate` å·²æ­£ç¡®åŠ è½½ âœ…

å¦åˆ™å°±æ˜¯ `Migrate()` åˆå§‹åŒ–ä½ç½®é”™äº† âŒ

---

æŒ‰è¿™ä¸ªç»“æ„æ”¹å®Œåï¼Œä½ å°±å®Œå…¨æ‘†è„±äº† `Flask-Script`ï¼Œä½¿ç”¨ç°ä»£ã€å®˜æ–¹æ”¯æŒçš„æ–¹å¼ç®¡ç†å‘½ä»¤äº†ã€‚