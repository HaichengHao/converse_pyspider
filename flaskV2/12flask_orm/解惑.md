你提到的 `Flask-Script` 确实已经被废弃，不再维护。现代 Flask 推荐使用 **Click** 命令行接口来创建自定义命令。`Flask-Migrate` 也早已支持与 Flask 的内置 CLI 集成，无需 `Flask-Script` 和 `Manager`。

下面是将你的旧代码迁移到现代 Flask CLI 风格的完整示例：

---

### ✅ 推荐方式：使用 Flask 内置 CLI + Click

#### 1. 项目结构建议
```
your_project/
├── app.py
├── settings.py
├── obj/
│   ├── __init__.py
│   └── exts.py
```

---

#### 2. `obj/exts.py`
```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()
```

---

#### 3. `obj/__init__.py`
```python
from flask import Flask
from .exts import db
from flask_migrate import Migrate

def create_app(config_name='development'):
    app = Flask(__name__)

    # 加载配置
    from settings import devConfig, proConfig  # 假设有多个配置
    config_map = {
        'development': devConfig,
        'production': proConfig
    }
    app.config.from_object(config_map.get(config_name, devConfig))

    # 初始化扩展
    db.init_app(app)
    Migrate(app, db)  # 自动注册 flask db 命令

    return app
```

---

#### 4. `app.py`（主程序入口）
```python
import click
from obj import create_app
from obj.exts import db

app = create_app()

# 自定义命令示例
@app.cli.command("init-db")
def init_db_command():
    """初始化数据库（创建表）"""
    db.create_all()
    click.echo("Initialized the database.")

@app.cli.command("hello")
@click.option('--name', default='World', help='名字')
def hello(name):
    """打招呼命令"""
    click.echo(f'Hello, {name}!')

if __name__ == '__main__':
    app.run(debug=True)
```

---

#### 5. 使用方式（命令行）

```bash
# 设置应用入口（Linux/macOS）
export FLASK_APP=app.py
export FLASK_ENV=development  # 或 FLASK_DEBUG=1

# Windows 使用 set 或 $env:FLASK_APP="app.py"（PowerShell）

# 运行开发服务器
flask run

# 查看所有命令
flask --help

# 查看 db 命令（来自 Flask-Migrate）
flask db --help

# 执行迁移操作
flask db init      # 首次创建迁移仓库
flask db migrate -m "Initial migration"
flask db upgrade

# 执行自定义命令
flask init-db
flask hello --name Alice
```

---

### ✅ 关键点说明

| 旧方式 | 新方式 |
|-------|--------|
| `Flask-Script` + `Manager` | Flask 内置 CLI（基于 Click） |
| `manager.add_command('db', MigrateCommand)` | `Migrate(app, db)` 自动注册 `flask db` 命令 |
| `python app.py runserver` | `flask run` |
| 自定义命令通过 `@manager.command` | 使用 `@app.cli.command()` |

---

### 🔁 迁移总结

你原来的代码：
```python
from flask_script import Manager
manager = Manager(app)
mig = Migrate(app=app,db=db)
manager.add_command('db', MigrateCommand)
```

现在完全不需要 `Manager`，只需：
```python
from flask_migrate import Migrate
Migrate(app, db)  # 这一行就自动启用了 flask db 命令
```

---

### ✅ 额外建议

- 卸载 `Flask-Script`：`pip uninstall Flask-Script`
- 确保安装了 `Flask-Migrate`：`pip install Flask-Migrate`
- 使用 `Flask` 2.0+ 版本以获得最佳 CLI 支持

---

这样你就完全摆脱了废弃的 `Flask-Script`，使用更现代、官方推荐的方式管理命令行工具。



你的代码**基本结构是对的**，但有一些**顺序和设计上的小问题**需要调整，才能确保 `Flask-Migrate` 正常工作，并符合现代 Flask 的最佳实践。

---

### ❌ 你当前代码的问题：

```python
app = create_app()
app.config.from_object(devConfig)  # ← 问题1：重复配置
db.init_app(app)                   # ← 问题2：create_app 内部应该做这事
mig = Migrate(app=app, db=db)      # ← 问题3：应在 create_app 中初始化
app.run()
```

#### 问题详解：

1. **`app.config.from_object(devConfig)` 放在了外面**  
   如果你在 `create_app()` 函数里已经设置了配置，这里又设置一次，属于重复操作，容易出错。

2. **`db.init_app(app)` 写在了主程序中**  
   扩展的初始化（如 `db.init_app(app)`）应该封装在 `create_app()` 工厂函数内部，这是工厂模式的核心思想。

3. **`Migrate(app, db)` 写在了外面**  
   同样，`Migrate` 也应该在 `create_app` 中初始化，否则 `flask db` 命令不会生效。

4. **没有启用 Flask CLI 支持的命令**  
   虽然你可以运行服务器，但如果你想用 `flask db migrate` 等命令，必须通过 `flask run` 启动，而不是直接 `app.run()`。

---

### ✅ 正确做法（推荐结构）

#### ✅ 1. `obj/__init__.py`
```python
from flask import Flask
from .exts import db
from flask_migrate import Migrate

def create_app(config_name='development'):
    app = Flask(__name__)
    
    # 加载配置
    from settings import devConfig
    app.config.from_object(devConfig)

    # 初始化扩展
    db.init_app(app)
    Migrate(app, db)  # 关键：在这里初始化 Migrate

    return app
```

#### ✅ 2. `app.py`（入口文件）
```python
from obj import create_app

app = create_app()

if __name__ == '__main__':
    # 仅用于开发时直接运行：python app.py
    app.run(host='0.0.0.0', port=5000, debug=True)
```

---

### ✅ 使用方式

#### 方式一：使用 Flask CLI（推荐）
```bash
export FLASK_APP=app.py
export FLASK_ENV=development
flask run
```

你可以正常使用迁移命令：
```bash
flask db init         # 首次创建迁移目录
flask db migrate -m "init"
flask db upgrade
```

#### 方式二：直接运行（仅开发）
```bash
python app.py
```

---

### ✅ 总结：你的代码怎么改？

你原来的主程序改成这样就 OK 了：

```python
from obj import create_app

if __name__ == '__main__':
    app = create_app()  # 所有初始化都在 create_app 里完成
    app.run()
```

然后把：
- `app.config.from_object(devConfig)`
- `db.init_app(app)`
- `Migrate(app, db)`

全部移到 `create_app()` 函数内部！

---

### 🎯 最终结论

> ❌ 你现在的写法 **不能完全正常工作**（尤其是 `flask db` 命令会失效）  
> ✅ 正确做法是：**把 `Migrate(app, db)` 放到 `create_app()` 函数中初始化**

---

### 🔁 小贴士：如何验证 Migrate 是否生效？

运行：
```bash
flask --help
```

如果看到 `db` 命令出现在列表中：
```
Commands:
  db    Perform database migrations.
  run   Run a development server.
  shell Run an interactive Python shell in the app context.
```

说明 `Flask-Migrate` 已正确加载 ✅

否则就是 `Migrate()` 初始化位置错了 ❌

---

按这个结构改完后，你就完全摆脱了 `Flask-Script`，使用现代、官方支持的方式管理命令了。